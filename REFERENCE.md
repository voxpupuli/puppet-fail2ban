# Reference

<!-- DO NOT EDIT: This document was generated by Puppet Strings -->

## Table of Contents

### Classes

#### Public Classes

* [`fail2ban`](#fail2ban): Installs, configures and manages the Fail2ban service.

#### Private Classes

* `fail2ban::config`: Handles the configuration file.
* `fail2ban::install`: Manage fail2ban packages
* `fail2ban::service`: Handles the service.

### Defined types

* [`fail2ban::action`](#fail2ban--action): Create a .local action in action.d
* [`fail2ban::filter`](#fail2ban--filter): Create a .local filter in filter.d
* [`fail2ban::jail`](#fail2ban--jail): Create a .local jail in jail.d

### Data types

* [`Fail2ban::IP`](#Fail2ban--IP): can be a list of IP addresses, CIDR masks or DNS hosts
* [`Fail2ban::Time`](#Fail2ban--Time): Describes time format allowed for bantime and findtime The time entries in fail2ban configuration (like findtime or bantime) can be provided 

### Tasks

* [`banip`](#banip): Ban IPs in a jail
* [`unban`](#unban): Unban IP in all jails and database
* [`unbanip`](#unbanip): Unban IP in a jail

## Classes

### <a name="fail2ban"></a>`fail2ban`

@example Set some [DEFAULT] parameters and enable two jails
  class { 'fail2ban':
    bantime  => '30m',
    maxretry => 5,
    jails => {
      sshd => {
        enabled => true,
        bantime => '1h',
      },
      ssh-selinux => {
        enabled => true,
      },
    },
  }

#### Parameters

The following parameters are available in the `fail2ban` class:

* [`package_ensure`](#-fail2ban--package_ensure)
* [`package_name`](#-fail2ban--package_name)
* [`package_list`](#-fail2ban--package_list)
* [`config_dir_path`](#-fail2ban--config_dir_path)
* [`config_dir_purge`](#-fail2ban--config_dir_purge)
* [`config_file_path`](#-fail2ban--config_file_path)
* [`config_file_owner`](#-fail2ban--config_file_owner)
* [`config_file_group`](#-fail2ban--config_file_group)
* [`config_file_mode`](#-fail2ban--config_file_mode)
* [`config_file_template`](#-fail2ban--config_file_template)
* [`config_file_notify`](#-fail2ban--config_file_notify)
* [`config_file_require`](#-fail2ban--config_file_require)
* [`debian_defaults_conf_ensure`](#-fail2ban--debian_defaults_conf_ensure)
* [`el_firewalld_conf_ensure`](#-fail2ban--el_firewalld_conf_ensure)
* [`service_ensure`](#-fail2ban--service_ensure)
* [`service_name`](#-fail2ban--service_name)
* [`service_enable`](#-fail2ban--service_enable)
* [`bantime_increment`](#-fail2ban--bantime_increment)
* [`bantime_rndtime`](#-fail2ban--bantime_rndtime)
* [`bantime_maxtime`](#-fail2ban--bantime_maxtime)
* [`bantime_factor`](#-fail2ban--bantime_factor)
* [`bantime_formula`](#-fail2ban--bantime_formula)
* [`bantime_multipliers`](#-fail2ban--bantime_multipliers)
* [`bantime_overalljails`](#-fail2ban--bantime_overalljails)
* [`ignoreself`](#-fail2ban--ignoreself)
* [`ignoreip`](#-fail2ban--ignoreip)
* [`ignorecommand`](#-fail2ban--ignorecommand)
* [`bantime`](#-fail2ban--bantime)
* [`findtime`](#-fail2ban--findtime)
* [`maxretry`](#-fail2ban--maxretry)
* [`maxmatches`](#-fail2ban--maxmatches)
* [`default_backend`](#-fail2ban--default_backend)
* [`usedns`](#-fail2ban--usedns)
* [`logencoding`](#-fail2ban--logencoding)
* [`enable_all_jails`](#-fail2ban--enable_all_jails)
* [`default_mode`](#-fail2ban--default_mode)
* [`default_filter`](#-fail2ban--default_filter)
* [`destemail`](#-fail2ban--destemail)
* [`sender`](#-fail2ban--sender)
* [`mta`](#-fail2ban--mta)
* [`protocol`](#-fail2ban--protocol)
* [`iptables_chain`](#-fail2ban--iptables_chain)
* [`port`](#-fail2ban--port)
* [`fail2ban_agent`](#-fail2ban--fail2ban_agent)
* [`banaction`](#-fail2ban--banaction)
* [`banaction_allports`](#-fail2ban--banaction_allports)
* [`action`](#-fail2ban--action)
* [`jails`](#-fail2ban--jails)

##### <a name="-fail2ban--package_ensure"></a>`package_ensure`

Data type: `Enum['absent', 'latest', 'present', 'purged']`

Determines if the package should be installed.

Default value: `'present'`

##### <a name="-fail2ban--package_name"></a>`package_name`

Data type: `String[1]`

Determines the name of package to manage.

Default value: `'fail2ban'`

##### <a name="-fail2ban--package_list"></a>`package_list`

Data type: `Optional[Array[String]]`

Determines if additional packages should be managed.

Default value: `undef`

##### <a name="-fail2ban--config_dir_path"></a>`config_dir_path`

Data type: `Stdlib::Absolutepath`

Configuration directory path

Default value: `'/etc/fail2ban'`

##### <a name="-fail2ban--config_dir_purge"></a>`config_dir_purge`

Data type: `Boolean`

Determines if unmanaged configuration files should be removed.

Default value: `false`

##### <a name="-fail2ban--config_file_path"></a>`config_file_path`

Data type: `Stdlib::Absolutepath`

Determines if the configuration file should be managed.

Default value: `'/etc/fail2ban/jail.local'`

##### <a name="-fail2ban--config_file_owner"></a>`config_file_owner`

Data type: `String[1]`

Determines which user should own the configuration file.

Default value: `'root'`

##### <a name="-fail2ban--config_file_group"></a>`config_file_group`

Data type: `String[1]`

Determines which group should own the configuration file.

Default value: `'root'`

##### <a name="-fail2ban--config_file_mode"></a>`config_file_mode`

Data type: `String[1]`

Determines the desired permissions mode of the configuration file.

Default value: `'0644'`

##### <a name="-fail2ban--config_file_template"></a>`config_file_template`

Data type: `String[1]`

Determines which configuration file template to use.

Default value: `'fail2ban/jail.local.epp'`

##### <a name="-fail2ban--config_file_notify"></a>`config_file_notify`

Data type: `String[1]`

Determines which service should be restarted after configuration changes.

Default value: `'Service[fail2ban]'`

##### <a name="-fail2ban--config_file_require"></a>`config_file_require`

Data type: `String[1]`

Determines which package a configuration file depends on.

Default value: `'Package[fail2ban]'`

##### <a name="-fail2ban--debian_defaults_conf_ensure"></a>`debian_defaults_conf_ensure`

Data type: `Enum['absent', 'present']`

Determines whether the file `/etc/fail2ban/jail.d/defaults-debian.conf` should be deleted or not.

Default value: `'present'`

##### <a name="-fail2ban--el_firewalld_conf_ensure"></a>`el_firewalld_conf_ensure`

Data type: `Enum['absent', 'present']`

Determines whether the file `/etc/fail2ban/jail.d/00-firewalld.conf` should be deleted or not.

Default value: `'present'`

##### <a name="-fail2ban--service_ensure"></a>`service_ensure`

Data type: `Enum['running', 'stopped']`

Determines if the service should be running or not.

Default value: `'running'`

##### <a name="-fail2ban--service_name"></a>`service_name`

Data type: `String[1]`

Determines the name of service to manage.

Default value: `'fail2ban'`

##### <a name="-fail2ban--service_enable"></a>`service_enable`

Data type: `Boolean`

Determines if the service should be enabled at boot.

Default value: `true`

##### <a name="-fail2ban--bantime_increment"></a>`bantime_increment`

Data type: `Optional[Boolean]`

Increment ban time for previously banned IPs.

Default value: `undef`

##### <a name="-fail2ban--bantime_rndtime"></a>`bantime_rndtime`

Data type: `Optional[Integer[1]]`

Maximum number of seconds to randomly add to ban time.

Default value: `undef`

##### <a name="-fail2ban--bantime_maxtime"></a>`bantime_maxtime`

Data type: `Optional[Integer[1]]`

Maximum ban time.

Default value: `undef`

##### <a name="-fail2ban--bantime_factor"></a>`bantime_factor`

Data type: `Optional[Integer[1]]`

Coefficient to increment ban time by.

Default value: `undef`

##### <a name="-fail2ban--bantime_formula"></a>`bantime_formula`

Data type: `Optional[String[1]]`

Formula used to calculate ban time.

Default value: `undef`

##### <a name="-fail2ban--bantime_multipliers"></a>`bantime_multipliers`

Data type: `Array[Integer]`

Alternative to formula, multiply ban time by multipliers.

Default value: `[]`

##### <a name="-fail2ban--bantime_overalljails"></a>`bantime_overalljails`

Data type: `Optional[Boolean]`

Search banned IPs over all jails.

Default value: `undef`

##### <a name="-fail2ban--ignoreself"></a>`ignoreself`

Data type: `Optional[Boolean]`

Ignore local IP address.

Default value: `undef`

##### <a name="-fail2ban--ignoreip"></a>`ignoreip`

Data type: `Optional[Array[Fail2ban::IP]]`

Determines which ip addresses will not be reported

Default value: `undef`

##### <a name="-fail2ban--ignorecommand"></a>`ignorecommand`

Data type: `Optional[String[1]]`

External command to evaluate if an IP should be ignored.

Default value: `undef`

##### <a name="-fail2ban--bantime"></a>`bantime`

Data type: `Optional[Fail2ban::Time]`

Determines how many time (second or hour or week) ip addresses will be banned.

Default value: `undef`

##### <a name="-fail2ban--findtime"></a>`findtime`

Data type: `Optional[Fail2ban::Time]`

Interval in which max retries are evaluated.

Default value: `undef`

##### <a name="-fail2ban--maxretry"></a>`maxretry`

Data type: `Optional[Integer[0]]`

Determines the number of failed login attempts needed to block a host.

Default value: `undef`

##### <a name="-fail2ban--maxmatches"></a>`maxmatches`

Data type: `Optional[String[1]]`

Number of stored matches.

Default value: `undef`

##### <a name="-fail2ban--default_backend"></a>`default_backend`

Data type: `Optional[Enum['pyinotify', 'polling', 'systemd', 'auto']]`

Default backend in use by fail2ban for file modification.

Default value: `undef`

##### <a name="-fail2ban--usedns"></a>`usedns`

Data type: `Optional[Enum['yes', 'warn', 'no', 'raw']]`

Perform DNS lookup of encountered hostnames.

Default value: `undef`

##### <a name="-fail2ban--logencoding"></a>`logencoding`

Data type: `Optional[String[1]]`

Encoding of log files (ascii, utf-8...).

Default value: `undef`

##### <a name="-fail2ban--enable_all_jails"></a>`enable_all_jails`

Data type: `Optional[Boolean]`

Enable all the jails known to fail2ban.

Default value: `undef`

##### <a name="-fail2ban--default_mode"></a>`default_mode`

Data type: `Optional[String[1]]`

Default mode of filters.

Default value: `undef`

##### <a name="-fail2ban--default_filter"></a>`default_filter`

Data type: `Optional[String[1]]`

Default filter in use by the jails.

Default value: `undef`

##### <a name="-fail2ban--destemail"></a>`destemail`

Data type: `Optional[String[1]]`

Determines which email address should be notified about restricted hosts and suspicious logins.

Default value: `undef`

##### <a name="-fail2ban--sender"></a>`sender`

Data type: `Optional[String[1]]`

Determines which email address should notify about restricted hosts and suspicious logins.

Default value: `undef`

##### <a name="-fail2ban--mta"></a>`mta`

Data type: `Optional[Enum['sendmail', 'mail']]`

MTA in use for mailing.

Default value: `undef`

##### <a name="-fail2ban--protocol"></a>`protocol`

Data type: `Optional[Enum['tcp', 'udp']]`

Default protocol.

Default value: `undef`

##### <a name="-fail2ban--iptables_chain"></a>`iptables_chain`

Data type: `Optional[String[1]]`

Determines chain where jumps will to be added in iptables-\* actions.

Default value: `undef`

##### <a name="-fail2ban--port"></a>`port`

Data type: `Optional[String[1]]`

Port interval to be banned, usually to be overridden in jails.

Default value: `undef`

##### <a name="-fail2ban--fail2ban_agent"></a>`fail2ban_agent`

Data type: `Optional[String[1]]`

User-agent compliant to RFC7231 Section-5.5.3

Default value: `undef`

##### <a name="-fail2ban--banaction"></a>`banaction`

Data type: `Optional[String[1]]`

Determines which action to perform when performing a global ban (not overridden in a specific jail).

Default value: `undef`

##### <a name="-fail2ban--banaction_allports"></a>`banaction_allports`

Data type: `Optional[String[1]]`

Determines which action to perform when performing a global ban for all ports (not overridden in a specific jail).

Default value: `undef`

##### <a name="-fail2ban--action"></a>`action`

Data type: `Optional[String[1]]`

Choose the default action to handle banned IPs.

Default value: `undef`

##### <a name="-fail2ban--jails"></a>`jails`

Data type: `Optional[Hash]`

Configures defaults jails in jail.local

Default value: `undef`

## Defined types

### <a name="fail2ban--action"></a>`fail2ban::action`

Create a .local action in action.d

#### Examples

##### Override action.d/abuseipdb.conf

```puppet
fail2ban::action { 'abuseipdb':
  action_name => 'abuseipdb',
  action_content => {
    'Definition' => {
      norestored => '0',
    },
    'Init' => {
      abuseipdb_apikey => 'my-very-secret-api-key',
    },
  },
}
```

#### Parameters

The following parameters are available in the `fail2ban::action` defined type:

* [`action_ensure`](#-fail2ban--action--action_ensure)
* [`action_name`](#-fail2ban--action--action_name)
* [`action_content`](#-fail2ban--action--action_content)

##### <a name="-fail2ban--action--action_ensure"></a>`action_ensure`

Data type: `Enum['present', 'absent']`

Removes the action if set to 'absent'

Default value: `'present'`

##### <a name="-fail2ban--action--action_name"></a>`action_name`

Data type: `Optional[String[1]]`

Name of the action, without .local

Default value: `undef`

##### <a name="-fail2ban--action--action_content"></a>`action_content`

Data type: `Hash`

Content of the action, each section is a sub-hash

Default value: `{}`

### <a name="fail2ban--filter"></a>`fail2ban::filter`

Create a .local filter in filter.d

#### Examples

##### Create filter.d/common.local

```puppet
fail2ban::filter { 'common':
  filter_name    => 'common',
  filter_content => {
    'DEFAULT' => {
      'logtype' => 'short',
     },
   },
  }
```

#### Parameters

The following parameters are available in the `fail2ban::filter` defined type:

* [`filter_ensure`](#-fail2ban--filter--filter_ensure)
* [`filter_name`](#-fail2ban--filter--filter_name)
* [`filter_content`](#-fail2ban--filter--filter_content)

##### <a name="-fail2ban--filter--filter_ensure"></a>`filter_ensure`

Data type: `Enum['present', 'absent']`

Removes the filter if set to 'absent'

Default value: `'present'`

##### <a name="-fail2ban--filter--filter_name"></a>`filter_name`

Data type: `Optional[String[1]]`

Name of the filter, without .local

Default value: `undef`

##### <a name="-fail2ban--filter--filter_content"></a>`filter_content`

Data type: `Hash`

Content of the filter, each section is a sub-hash

Default value: `{}`

### <a name="fail2ban--jail"></a>`fail2ban::jail`

Create a .local jail in jail.d

#### Examples

##### Create jail.d/nginx-wp-login.local

```puppet
fail2ban::jail { 'nginx-wp-login':
  jail_name    => 'nginx-wp-login',
  jail_content => {
    'nginx-wp-login' => {
      'jail_failregex' => '<HOST>.*] "POST /wp-login.php',
      'port'           => 'http,https',
      'logpath'        => '/var/log/nginx/access.log',
    },
  },
}
```

#### Parameters

The following parameters are available in the `fail2ban::jail` defined type:

* [`jail_ensure`](#-fail2ban--jail--jail_ensure)
* [`jail_name`](#-fail2ban--jail--jail_name)
* [`jail_content`](#-fail2ban--jail--jail_content)

##### <a name="-fail2ban--jail--jail_ensure"></a>`jail_ensure`

Data type: `Enum['present', 'absent']`

Removes the jail if set to 'absent'

Default value: `'present'`

##### <a name="-fail2ban--jail--jail_name"></a>`jail_name`

Data type: `Optional[String[1]]`

Name of the jail, without .local

Default value: `undef`

##### <a name="-fail2ban--jail--jail_content"></a>`jail_content`

Data type: `Hash`

Content of the jail, each section is a sub-hash

Default value: `{}`

## Data types

### <a name="Fail2ban--IP"></a>`Fail2ban::IP`

can be a list of IP addresses, CIDR masks or DNS hosts

Alias of `Variant[Stdlib::Fqdn, Stdlib::IP::Address, Stdlib::IP::Address::CIDR]`

### <a name="Fail2ban--Time"></a>`Fail2ban::Time`

Describes time format allowed for bantime and findtime
The time entries in fail2ban configuration (like findtime or bantime)
can be provided as integer in seconds or as string using special abbreviation
format (e. g. 600 is the same as 10m).

Abbreviation tokens:

  years?, yea?, yy?
  months?, mon?
  weeks?, wee?, ww?
  days?, da, dd?
  hours?, hou?, hh?
  minutes?, min?, mm?
  seconds?, sec?, ss?

  The question mark (?) means the optional character, so day as well as days can be used.

You can combine multiple tokens in format (separated with space resp. without separator), e. g.: 1y 6mo or 1d12h30m.
Note that tokens m as well as mm means minutes, for month use abbreviation mo or mon.

The time format can be tested using fail2ban-client:

       fail2ban-client --str2sec 1d12h

Alias of `Variant[Integer[0], Pattern['^\d.*$']]`

## Tasks

### <a name="banip"></a>`banip`

Ban IPs in a jail

**Supports noop?** false

#### Parameters

##### `jail`

Data type: `String[1]`

The jail to operate on

##### `ips`

Data type: `Array[Stdlib::IP::Address]`

IP addresses to ban

### <a name="unban"></a>`unban`

Unban IP in all jails and database

**Supports noop?** false

#### Parameters

##### `ips`

Data type: `Array[Stdlib::IP::Address]`

IP addresses to unban

### <a name="unbanip"></a>`unbanip`

Unban IP in a jail

**Supports noop?** false

#### Parameters

##### `jail`

Data type: `String[1]`

The jail to operate on

##### `ips`

Data type: `Array[Stdlib::IP::Address]`

IP addresses to unban

